<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>执行栈和执行上下文 | 浅谈 frontEnd</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="面试题型">
    
    <link rel="preload" href="/learn-frontEnd/assets/css/0.styles.095c4e67.css" as="style"><link rel="preload" href="/learn-frontEnd/assets/js/app.a6f53f1e.js" as="script"><link rel="preload" href="/learn-frontEnd/assets/js/3.ca6c355c.js" as="script"><link rel="preload" href="/learn-frontEnd/assets/js/1.912b4b55.js" as="script"><link rel="preload" href="/learn-frontEnd/assets/js/43.f04ec2a4.js" as="script"><link rel="prefetch" href="/learn-frontEnd/assets/js/10.53debd4c.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/11.875bc546.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/12.38103a32.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/13.0bf533ef.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/14.023c4de0.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/15.4a633db1.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/16.109616bd.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/17.b1a21864.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/18.fc2c2bc9.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/19.40db45fc.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/20.2a596698.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/21.74eea582.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/22.675e38b1.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/23.fea76b1f.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/24.f75134b1.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/25.afa0d0fa.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/26.bd574306.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/27.e91c9cf3.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/28.647734cc.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/29.a64cd4ee.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/30.6b2d37e2.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/31.51fa4964.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/32.f0784b94.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/33.ad160945.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/34.6e2d6f93.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/35.6455818b.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/36.724eb922.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/37.2ecd354a.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/38.26750074.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/39.d3033a29.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/4.673bf15a.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/40.170cc41c.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/41.1e588af9.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/42.716dea9c.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/44.b4d76847.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/45.8ec1ccf0.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/46.46e7378d.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/47.857e5adf.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/48.5803ca3e.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/49.98aae8a2.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/5.8b013b29.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/50.6d5c2eee.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/51.dd99d95c.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/52.c1c039e9.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/53.9b307f69.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/54.bd1754fd.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/55.631ed0af.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/56.0cb8dcec.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/57.fff8c962.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/58.1fc6b24a.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/59.510808ed.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/6.aad79307.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/60.f5c5aaaa.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/61.a738a9bb.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/62.25f19e8a.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/63.e0fd8967.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/7.8e49b54c.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/8.1296ca76.js"><link rel="prefetch" href="/learn-frontEnd/assets/js/9.cd910413.js">
    <link rel="stylesheet" href="/learn-frontEnd/assets/css/0.styles.095c4e67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>浅谈 frontEnd</h3> <p class="description" data-v-59e6cb88>面试题型</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-frontEnd/" class="home-link router-link-active"><!----> <span class="site-name">浅谈 frontEnd</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-frontEnd/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      _心的 JavaScript 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/AnxinXiao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>54</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/learn-frontEnd/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      _心的 JavaScript 博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/AnxinXiao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/learn-frontEnd/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-frontEnd/" aria-current="page" class="sidebar-link">学前必读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/learn-frontEnd/handbook/html/documentStatement" class="sidebar-heading clickable"><span>HTML学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-frontEnd/handbook/html/documentStatement.html" class="sidebar-link">文档声明</a></li><li><a href="/learn-frontEnd/handbook/html/Semanticization.html" class="sidebar-link">语义化</a></li><li><a href="/learn-frontEnd/handbook/html/W3COrganization.html" class="sidebar-link">W3C标准组织</a></li><li><a href="/learn-frontEnd/handbook/html/SEO.html" class="sidebar-link">SEO</a></li><li><a href="/learn-frontEnd/handbook/html/iframe.html" class="sidebar-link">iframe</a></li><li><a href="/learn-frontEnd/handbook/html/Microformats.html" class="sidebar-link">微格式</a></li><li><a href="/learn-frontEnd/handbook/html/replacementElement.html" class="sidebar-link">替换元素</a></li><li><a href="/learn-frontEnd/handbook/html/PageVisibility.html" class="sidebar-link">页面可见性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/learn-frontEnd/handbook/css/cssUnits" class="sidebar-heading clickable"><span>CSS学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-frontEnd/handbook/css/cssUnits.html" class="sidebar-link">CSS单位</a></li><li><a href="/learn-frontEnd/handbook/css/centeringMethod.html" class="sidebar-link">居中方式</a></li><li><a href="/learn-frontEnd/handbook/css/hiddenElements.html" class="sidebar-link">隐藏元素</a></li><li><a href="/learn-frontEnd/handbook/css/position.html" class="sidebar-link">定位</a></li><li><a href="/learn-frontEnd/handbook/css/BFC.html" class="sidebar-link">BFC</a></li><li><a href="/learn-frontEnd/handbook/css/attributeCalculation.html" class="sidebar-link">CSS属性的计算过程</a></li><li><a href="/learn-frontEnd/handbook/css/cascadingInheritance.html" class="sidebar-link">CSS层叠继承规则总结</a></li><li><a href="/learn-frontEnd/handbook/css/CSS3CalcFunction.html" class="sidebar-link">CSS3的calc函数</a></li><li><a href="/learn-frontEnd/handbook/css/mediaInquiry.html" class="sidebar-link">CSS3媒体查询</a></li><li><a href="/learn-frontEnd/handbook/css/Excess&amp;Animation.html" class="sidebar-link">过渡和动画事件</a></li><li><a href="/learn-frontEnd/handbook/css/Progressive.html" class="sidebar-link">渐进增强和优雅降级</a></li><li><a href="/learn-frontEnd/handbook/css/CSS3Deformation.html" class="sidebar-link">CSS3变形指令</a></li><li><a href="/learn-frontEnd/handbook/css/progressiveRendering.html" class="sidebar-link">渐进式渲染t指令</a></li><li><a href="/learn-frontEnd/handbook/css/renderingPerformanceOptimization.html" class="sidebar-link">CSS渲染性能优化</a></li><li><a href="/learn-frontEnd/handbook/css/cascadingContext.html" class="sidebar-link">层叠上下文</a></li><li><a href="/learn-frontEnd/handbook/css/CSS3Masking.html" class="sidebar-link">CSS3遮罩</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/learn-frontEnd/handbook/js/let&amp;var&amp;const" class="sidebar-heading clickable open"><span>JS学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-frontEnd/handbook/js/let&amp;var&amp;const.html" class="sidebar-link">let、var、const的区别</a></li><li><a href="/learn-frontEnd/handbook/js/value&amp;References.html" class="sidebar-link">值和引用</a></li><li><a href="/learn-frontEnd/handbook/js/packageType.html" class="sidebar-link">包装类型</a></li><li><a href="/learn-frontEnd/handbook/js/DataTypeConversion.html" class="sidebar-link">数据类型的转换</a></li><li><a href="/learn-frontEnd/handbook/js/Operators.html" class="sidebar-link">运算符</a></li><li><a href="/learn-frontEnd/handbook/js/prototypes&amp;prototypeChains.html" class="sidebar-link">原型和原型链</a></li><li><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html" aria-current="page" class="active sidebar-link">执行栈和执行上下文</a></li><li><a href="/learn-frontEnd/handbook/js/Scopes&amp;scopeChains.html" class="sidebar-link">作用域和作用域链</a></li><li><a href="/learn-frontEnd/handbook/js/thisPoint.html" class="sidebar-link">this指向</a></li><li><a href="/learn-frontEnd/handbook/js/garbageCollection&amp;memoryLeaks.html" class="sidebar-link">垃圾回收与内存泄漏</a></li><li><a href="/learn-frontEnd/handbook/js/Closures.html" class="sidebar-link">闭包</a></li><li><a href="/learn-frontEnd/handbook/js/DOMEventRegistration&amp;Removal.html" class="sidebar-link">DOM事件的注册和移除</a></li><li><a href="/learn-frontEnd/handbook/js/DOMPropagationMechanism.html" class="sidebar-link">DOM事件的传播机制</a></li><li><a href="/learn-frontEnd/handbook/js/DefaultBehaviorForBlockingEvents.html" class="sidebar-link">阻止事件的默认行为</a></li><li><a href="/learn-frontEnd/handbook/js/Recursive.html" class="sidebar-link">递归</a></li><li><a href="/learn-frontEnd/handbook/js/propertyDescriptors.html" class="sidebar-link">属性描述符</a></li><li><a href="/learn-frontEnd/handbook/js/class&amp;normalConstructors.html" class="sidebar-link">Class和普通构造器的区别</a></li><li><a href="/learn-frontEnd/handbook/js/floatingPointPrecisionProblem.html" class="sidebar-link">浮点数精度问题</a></li><li><a href="/learn-frontEnd/handbook/js/strictMode.html" class="sidebar-link">严格模式</a></li><li><a href="/learn-frontEnd/handbook/js/FunctionAntiShake&amp;throttling.html" class="sidebar-link">函数防抖和节流</a></li><li><a href="/learn-frontEnd/handbook/js/WeakSet&amp;WeakMap.html" class="sidebar-link">WeakSet和WeakMap</a></li><li><a href="/learn-frontEnd/handbook/js/Deep&amp;shallowCopy.html" class="sidebar-link">深浅拷贝</a></li><li><a href="/learn-frontEnd/handbook/js/FunctionCoriolisation.html" class="sidebar-link">函数柯里化</a></li><li><a href="/learn-frontEnd/handbook/js/floatingPointPrecisionProblem.html" class="sidebar-link">浮点数精度问题</a></li><li><a href="/learn-frontEnd/handbook/js/strictMode.html" class="sidebar-link">严格模式</a></li><li><a href="/learn-frontEnd/handbook/js/moreKnowledge.html" class="sidebar-link">更多知识</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">执行栈和执行上下文</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="执行栈和执行上下文"><a href="#执行栈和执行上下文" class="header-anchor">#</a> 执行栈和执行上下文</h1> <h2 id="经典真题"><a href="#经典真题" class="header-anchor">#</a> 经典真题</h2> <ul><li>谈谈你对 <em>JavaScript</em> 执行上下文栈理解</li></ul> <h2 id="执行上下文"><a href="#执行上下文" class="header-anchor">#</a> 执行上下文</h2> <p>执行上下文，英文全称为 <em>Execution Context</em>，一句话概括就是“代码（全局代码、函数代码）执行前进行的准备工作”，也称之为“执行上下文环境”。</p> <p>运行 <em>JavaScript</em> 代码时，当代码执行进入一个环境时，就会为该环境创建一个执行上下文，它会在你运行代码前做一些准备工作，如确定作用域，创建局部变量对象等。</p> <p>具体做了什么我们后面再说，先来看下 <em>JavaScript</em> 执行环境有哪些？</p> <p><strong><em>JavaScript</em> 中执行环境</strong></p> <ol><li>全局环境</li> <li>函数环境</li> <li><em>eval</em> 函数环境 （已不推荐使用）</li></ol> <p>那么与之对应的执行上下文类型同样有 <em>3</em> 种：</p> <ol><li>全局执行上下文</li> <li>函数执行上下文</li> <li><em>eval</em> 函数执行上下文</li></ol> <p><em>JavaScript</em> 运行时首先会进入全局环境，对应会生成全局上下文。程序代码中基本都会存在函数，那么<strong>调用函数</strong>，就会进入函数执行环境，对应就会生成该函数的执行上下文。</p> <p>由于代码中会声明多个函数，对应的函数执行上下文也会存在多个。在 <em>JavaScript</em> 中，通过栈的存取方式来管理执行上下文，我们可称其为执行栈，或函数调用栈（<em>Call Stack</em>）。</p> <h2 id="栈数据结构"><a href="#栈数据结构" class="header-anchor">#</a> 栈数据结构</h2> <p>先来简单复习一下栈这种数据结构。</p> <p>要简单理解栈的存取方式，我们可以通过类比乒乓球盒子来分析。如下图：</p> <p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-10-02-060310.png" alt="img"></p> <p>栈遵循**“先进后出，后进先出”**的规则，或称 <em><strong>LIFO</strong></em> （”<em>Last In First Out</em>“）规则。</p> <p>如图所示，我们只能从栈顶取出或放入乒乓球，最先放进盒子的总是最后才能取出。</p> <p>栈中**“放入/取出”<strong>，也可称为</strong>“入栈/出栈”**。</p> <p>总结栈数据结构的特点：</p> <ol><li>后进先出，先进后出</li> <li>出口在顶部，且仅有一个</li></ol> <p><strong>执行栈（函数调用栈）</strong></p> <p>理解完栈的存取方式，我们接着分析 <em>JavaScript</em> 中如何通过栈来管理多个执行上下文。</p> <p>程序执行进入一个执行环境时，它的执行上下文就会被创建，并被推入执行栈中（入栈）；程序执行完成时，它的执行上下文就会被销毁，并从栈顶被推出（出栈），控制权交由下一个执行上下文。</p> <p>因为 <em>JavaScript</em> 在执行代码时最先进入全局环境，所以<strong>处于栈底的永远是全局环境的执行上下文</strong>。而处于<strong>栈顶的是当前正在执行函数的执行上下文</strong>。</p> <p>当函数调用完成后，它就会从栈顶被推出，理想的情况下，闭包会阻止该操作，闭包可以参阅《闭包》章节。</p> <p>而全局环境只有一个，对应的全局执行上下文也只有一个，只有当页面被关闭之后它才会从执行栈中被推出，否则一直存在于栈底。</p> <p>下面我们来看一段具体的代码示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
      <span class="token keyword">return</span> <span class="token string">'I am bar'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对应图解如下：</p> <img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-10-02-060848.png" alt="image-20211002140848188" style="zoom:33%;"> <p><strong>执行上下文的数量限制（堆栈溢出）</strong></p> <p>执行上下文可存在多个，虽然没有明确的数量限制，但如果超出栈分配的空间，会造成堆栈溢出。常见于递归调用，没有终止条件造成死循环的场景。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 递归调用自身</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 报错： Uncaught RangeError: Maximum call stack size exceeded</span>
</code></pre></div><h2 id="执行上下文生命周期"><a href="#执行上下文生命周期" class="header-anchor">#</a> 执行上下文生命周期</h2> <p>前面我们有说到，运行 <em>JavaScript</em> 代码时，当代码执行进入一个环境时，就会为该环境创建一个执行上下文，它会在你运行代码前做一些准备工作。接下来我们就来看一下具体会做哪些准备工作。</p> <p>具体要做的事，和执行上下文的生命周期有关。</p> <p>执行上下文的生命周期有两个阶段：</p> <ol><li>创建阶段（<strong>进入</strong>执行上下文）：函数被调用时，进入函数环境，为其创建一个执行上下文，此时进入创建阶段。</li> <li>执行阶段（代码<strong>执行</strong>）：执行函数中代码时，此时执行上下文进入执行阶段。</li></ol> <p><strong>创建阶段</strong></p> <p>创建阶段要做的事情主要如下：</p> <ol><li><p>创建变量对象（<em>VO：variable object</em>）</p> <ul><li><p>确定函数的形参（<strong>并赋值</strong>）</p></li> <li><p>函数环境会初始化创建 <em>Arguments</em>对象（<strong>并赋值</strong>）</p></li> <li><p>确定普通字面量形式的函数声明（<strong>并赋值</strong>）</p></li> <li><p>变量声明，函数表达式声明（<strong>未赋值</strong>）</p></li></ul></li> <li><p>确定 <em>this</em> 指向（<strong><em>this</em> 由调用者确定</strong>）</p></li> <li><p>确定作用域（<strong>词法环境决定，哪里声明定义，就在哪里确定</strong>）</p></li></ol> <p>这里有必要说一下变量对象。</p> <p>当处于执行上下文的建立阶段时，我们可以将整个上下文环境看作是一个对象。该对象拥有 <em>3</em> 个属性，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>executionContextObj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">variableObject</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 变量对象，里面包含 Arguments 对象，形式参数，函数和局部变量</span>
    <span class="token literal-property property">scopeChain</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 作用域链，包含内部上下文所有变量对象的列表</span>
    <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// 上下文中 this 的指向对象</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，这里执行上下文抽象成为了一个对象，拥有 <em>3</em> 个属性，分别是<strong>变量对象</strong>，<strong>作用域链</strong>以及 <strong><em>this</em> 指向</strong>，这里我们重点来看一下变量对象里面所拥有的东西。</p> <p>在函数的建立阶段，首先会建立 <em>Arguments</em> 对象。然后确定形式参数，检查当前上下文中的函数声明，每找到一个函数声明，就在 <em>variableObject</em> 下面用函数名建立一个属性，属性值就指向该函数在内存中的地址的一个引用。</p> <p>如果上述函数名已经存在于 <em>variableObject</em>（简称 <em>VO</em>） 下面，那么对应的属性值会被新的引用给覆盖。</p> <p>最后，是确定当前上下文中的局部变量，如果遇到和函数名同名的变量，则会忽略该变量。</p> <p><strong>执行阶段</strong></p> <ol><li>变量对象赋值
<ul><li>变量赋值</li> <li>函数表达式赋值</li></ul></li> <li>调用函数</li> <li>顺序执行其它代码</li></ol> <p>两个阶段要做的事情介绍完毕，接下来我们来通过代码来演示一下这两个阶段做的每一件事以及变量对象是如何变化的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">privateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先在建立阶段的变量对象如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>fooExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">variavleObject</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token literal-property property">length</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 确定 Arguments 对象</span>
        <span class="token literal-property property">i</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 确定形式参数</span>
        <span class="token literal-property property">c</span> <span class="token operator">:</span> pointer to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 确定函数引用</span>
        <span class="token literal-property property">a</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token comment">// 局部变量 初始值为 undefined</span>
        <span class="token literal-property property">b</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>  <span class="token comment">// 局部变量 初始值为 undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scopeChain</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由此可见，在建立阶段，除了 <em>Arguments</em>，函数的声明，以及形式参数被赋予了具体的属性值外，其它的变量属性默认的都是 <em>undefined</em>。并且普通形式声明的函数的提升是在变量的上面的。</p> <p>一旦上述建立阶段结束，引擎就会进入代码执行阶段，这个阶段完成后，上述执行上下文对象如下，变量会被赋上具体的值。</p> <div class="language-js extra-class"><pre class="language-js"><code>fooExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">variavleObject</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token literal-property property">length</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">i</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token literal-property property">c</span> <span class="token operator">:</span> pointer to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a</span> <span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span><span class="token comment">// a 变量被赋值为 Hello</span>
        <span class="token literal-property property">b</span> <span class="token operator">:</span> pointer to <span class="token keyword">function</span> <span class="token function">privateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// b 变量被赋值为 privateB() 函数</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scopeChain</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们看到，只有在代码执行阶段，局部变量才会被赋予具体的值。在建立阶段局部变量的值都是 <em>undefined</em>。</p> <p>这其实也就解释了变量提升的原理。</p> <p>接下来我们再通过一段代码来加深对函数这两个阶段的过程的理解，代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;good&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>这里，我们定义了一个 <em>IIFE</em>，该函数在建立阶段的变量对象如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>fooExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">variavleObject</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">length</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">foo</span> <span class="token operator">:</span> pointer to <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">bar</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scopeChain</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先确定 <em>Arguments</em> 对象，接下来是形式参数，由于本例中不存在形式参数，所以接下来开始确定函数的引用，找到 <em>foo</em> 函数后，创建 <em>foo</em> 标识符来指向这个 <em>foo</em> 函数，之后同名的 <em>foo</em> 变量不会再被创建，会直接被忽略。</p> <p>然后创建 <em>bar</em> 变量，不过初始值为 <em>undefined</em>。</p> <p>建立阶段完成之后，接下来进入代码执行阶段，开始一句一句的执行代码，结果如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span> <span class="token comment">// foo 被重新赋值 变成了一个字符串</span>
    <span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;good&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hello string</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="真题解答"><a href="#真题解答" class="header-anchor">#</a> 真题解答</h2> <ul><li>谈谈你对 <em>JavaScript</em> 执行上下文栈理解</li></ul> <blockquote><p>参考答案：</p> <p><strong>什么是执行上下文？</strong></p> <p>简而言之，执行上下文是评估和执行 <em>JavaScript</em> 代码的环境的抽象概念。每当 <em>Javascript</em> 代码在运行的时候，它都是在执行上下文中运行。</p> <p><strong>执行上下文的类型</strong></p> <p><em>JavaScript</em> 中有三种执行上下文类型。</p> <ul><li>**全局执行上下文：**这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事，创建一个全局的 <em>window</em> 对象（浏览器的情况下），并且设置 <em>this</em> 的值等于这个全局对象。一个程序中只会有一个全局执行上下文。</li> <li>**函数执行上下文：**每当一个函数被调用时, 都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序（将在后文讨论）执行一系列步骤。</li> <li>**<em>Eval</em> 函数执行上下文：**执行在 <em>eval</em> 函数内部的代码也会有它属于自己的执行上下文。</li></ul> <p><strong>调用栈</strong></p> <p>调用栈是解析器（如浏览器中的的 <em>JavaScript</em> 解析器）的一种机制，可以在脚本调用多个函数时，跟踪每个函数在完成执行时应该返回控制的点。（如什么函数正在执行，什么函数被这个函数调用，下一个调用的函数是谁）</p> <ul><li>当脚本要调用一个函数时，解析器把该函数添加到栈中并且执行这个函数。</li> <li>任何被这个函数调用的函数会进一步添加到调用栈中，并且运行到它们被上个程序调用的位置。</li> <li>当函数运行结束后，解释器将它从堆栈中取出，并在主代码列表中继续执行代码。</li> <li>如果栈占用的空间比分配给它的空间还大，那么则会导致“栈溢出”错误。</li></ul></blockquote> <p>-<em>EOF</em>-</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/learn-frontEnd/handbook/js/prototypes&amp;prototypeChains.html" class="prev">
          原型和原型链
        </a></span> <span class="next"><a href="/learn-frontEnd/handbook/js/Scopes&amp;scopeChains.html">
          作用域和作用域链
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html#经典真题" class="sidebar-link reco-side-经典真题" data-v-b57cc07c>经典真题</a></li><li class="level-2" data-v-b57cc07c><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html#执行上下文" class="sidebar-link reco-side-执行上下文" data-v-b57cc07c>执行上下文</a></li><li class="level-2" data-v-b57cc07c><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html#栈数据结构" class="sidebar-link reco-side-栈数据结构" data-v-b57cc07c>栈数据结构</a></li><li class="level-2" data-v-b57cc07c><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html#执行上下文生命周期" class="sidebar-link reco-side-执行上下文生命周期" data-v-b57cc07c>执行上下文生命周期</a></li><li class="level-2" data-v-b57cc07c><a href="/learn-frontEnd/handbook/js/ExecutionStack&amp;ExecutionContext.html#真题解答" class="sidebar-link reco-side-真题解答" data-v-b57cc07c>真题解答</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/learn-frontEnd/assets/js/app.a6f53f1e.js" defer></script><script src="/learn-frontEnd/assets/js/3.ca6c355c.js" defer></script><script src="/learn-frontEnd/assets/js/1.912b4b55.js" defer></script><script src="/learn-frontEnd/assets/js/43.f04ec2a4.js" defer></script>
  </body>
</html>
